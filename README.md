# DiskSnap 磁盘快照管理系统

DiskSnap 是一个基于 C++ 开发的系统级项目，实现了磁盘快照管理、副本控制和请求调度等核心功能，用于解决磁盘数据一致性与高效访问问题。

## 目录结构

```
.
├── include/                 # 头文件目录
├── src/                     # 源文件目录
├── build/                   # 构建目录
├── CMakeLists.txt           # CMake 构建配置文件
├── notice.md                # 项目说明文档
├── run.bat                  # 运行脚本 (Windows)
├── rundebug.bat             # 调试运行脚本 (Windows)
├── runofficial.bat          # 正式运行脚本 (Windows)
└── README.md                # 项目说明文件
```

## 项目概述

DiskSnap 是一个高性能的磁盘快照管理系统，主要功能包括：

- 磁盘快照管理：创建、维护和管理磁盘快照
- 副本控制：实现磁盘区域的副本生成与同步
- 请求调度：处理来自系统的读写请求并进行调度
- 多线程协调：使用 PersuadeThread 模块进行线程间协调

## 技术架构

### 核心组件

1. **System** - 系统主入口，负责整体流程控制
2. **DiskManager** - 磁盘管理器，管理所有磁盘实例
3. **Disk** - 磁盘类，表示单个磁盘及其存储内容
4. **Scheduler** - 调度器，负责请求调度和任务分发
5. **PersuadeThread** - 线程协调模块，处理多线程任务
6. **Request** - 请求类，表示客户端的读写请求
7. **Replica** - 副本类，管理对象的副本信息
8. **Object** - 对象类，表示存储的基本单位

### 主要特性

- 基于 C++11 标准开发
- 多线程并发处理
- 磁盘负载均衡策略
- 高效的磁盘空间管理
- 快照和副本机制保证数据安全



## 核心算法

### 磁盘读取策略

- 第一次出现的目标大于(令牌-64)就进行jump，否则pass
- 轮询每个磁盘，每次磁盘返回(查找目标-已找到目标)
- 查找目标个数为零即返回

### 磁盘写入策略

- 使用双向链表维护空闲块，如 `dummy<->[1,3]<->[5,8]<->[10,100]<->null`
- 对于第一个遇到可以存储的空闲块进行切片预存储
- 若找到可连续存储的空闲块则直接进行存储并上报
- 采用负载均衡策略，综合考虑磁盘空闲总容量/连续空闲大小/已存某个TAG数量

### 备份策略

- 轮询磁盘进行备份
- 采用与写入相同的负载均衡策略

## 项目配置

程序启动时需要输入以下参数：

- `T` - 数据总帧数
- `M` - 标签数量
- `N` - 磁盘数量
- `V` - 磁盘容量
- `G` - 时间片内时间长度

## 构建说明

### 环境要求

- C++11 兼容编译器 (GCC 7+, Clang 5+, MSVC 2017+)
- CMake 3.8+

### 构建步骤

```bash
# 创建构建目录
mkdir build && cd build

# 生成构建配置
cmake ..

# 编译项目
make
```

在 Windows 系统上，也可以直接使用 Visual Studio 打开项目进行构建。

## 运行方式

项目提供多个运行脚本：

- `run.bat` - 标准运行模式
- `rundebug.bat` - 调试模式
- `runofficial.bat` - 正式运行模式

也可以直接运行生成的可执行文件：

```bash
./code_craft        # Linux/macOS
code_craft.exe      # Windows
```

## 开发说明

### 代码规范

- 遵循现代 C++ 编程实践
- 使用 RAII 原则管理资源
- 采用模块化设计，便于扩展和维护

### 注意事项

- Windows 与非 Windows 平台在链接库方面存在差异
- 多线程环境下可能存在竞态条件或死锁风险，需仔细调试

## 许可证

本项目为华为软件精英挑战赛参赛作品，仅供学习交流使用。